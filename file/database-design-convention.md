数据库设计规范
========================

1. 每个表都要有主键，名称是id，类型为bigint
----------------------------------

个别情况特殊情况，比如数据仓库的表，允许数据重复，可以不要主键。

Lookup Table，也就是字典表，数据打死都不会变的，可以不用大整数id这种代理主键，可以采用其本身的自然主键。

多对多的关系，这个关系本身如果没有其他意义，没有被其他地方做外键引用，那么也不需要大整数id这种代理主键，可以采用组合主键。

2. 先做normalization，不要过早优化
----------------------------------

Normalization要做到3NF。

Normalize till it hurts, then denormalize till it works.

不要在项目初期就总是担心性能会有问题，你的应用还没做出来，多花点儿精力在“把你的东西做出来”上面，不要总想着优化。等你的应用做好了，开始用了，你通过实际应用或者压力测试，发现了性能问题，再去优化。

3. 一个字段不要有多个用途
----------------------------------

空间不是问题，清晰才是重点。不要觉得自己能“复用”某个字段还觉得自己很牛逼，这是在给自己挖坑。

4. 字段的类型要定义精确
----------------------------------

boolean的类型就用boolean，不要用int或者char。boolean的字段都要用“is_”开头。

5. 字符串varchar的长度限制不确定时设成255
----------------------------------

这是最经济的，再小的长度，比如说varchar(50)这样的，并没有节省什么空间，50的意义只在于它强制限制字符串最多只能到50个字符，而并不代表比255节省空间。

当你的字符串并不是非常明确到底限制是多少的时候，通常我们会用255这个长度，一般来说足够大，也最经济。

而且，我们不推荐在数据库设计的早期对这些字符串长度做更细的长度定义，大部分的这种工作是无用的。我们只有非常明确的知道某个数据的最大长度的时候才会做定义，不知道的时候或者不太清楚的时候就都是255。

**注意：** 这里的255并不是数据库varchar类型的缺省长度，我们这里的255，是指的在业务逻辑中你暂时不确定这个字符串应该限制多长合适，设置成255是个不错的选择。

6. Cascade定义要明确
----------------------------------

到底Delete的时候是什么操作，Update的时候是什么操作，应该显示的定义，不要隐含。

7. 对数据的要求要定义明确的Constraints
----------------------------------

比如数据必须是某几个内容之一，这种就应该定义清楚。

8. 对外键要加Index
----------------------------------

这个动作经常忘记，会在项目初期就造成性能问题，然后对整体设计产生疑问。

9. 数据库里面的密码一定要加密，不能保存明文
----------------------------------

不嫌丢人就用明文！

10. 大数据BLOB等要单独放
----------------------------------

大数据比如blob类型，体积大，访问频率不高，不要和其他频繁访问的小数据放在一个表里，要放在自己单独的表里。还有，是否有必要在数据库中保存这些blob数据是个需要考虑的问题，通常是放在文件系统中的文件。

11. Lookup Table可以用一个大表放很多不同类型的数据吗？
----------------------------------
Q：Lookup Table，也就是字典表，通常都是类似key->value这种结构，不同类型的Lookup Table，其实结构都类似，那么，我是不是可以把很多原始数据、资源数据，统统放在一个Lookup Table里呢？这样节省很多表啊！

A：这不是一个正常的方式，我们需要明确的知道表和表之间的引用关系，这个对系统的清晰性条理性很重要。如果都用一个表来存这些资源数据，那么就丧失了条理性，提高了学习和理解整个系统的成本，人为的增加门槛和挖坑。

12. 业务上的删除，通常并不是数据库中数据的删除，用`is_deleted`来标识删除
----------------------------------

当我们说用户点击的某个删除按钮，然后这个数据就被删除了。这是在描述一种业务操作，并不是说数据库中这些数据就真的被DELETE了。通常，你会有“恢复”刚才删除的数据的需求，如果你真的在数据库中删除了数据，你怎么恢复呢？

所以，我们在做数据库设计的时候，大多数“删除”的业务是通过一个Boolean类型的字段，通常都叫`is_deleted`来表示这行数据是否被业务上删除了，而不是真的把这行数据真正的删掉。